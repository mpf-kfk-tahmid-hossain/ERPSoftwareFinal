{% extends 'base.html' %}
{% block title %}Category Tree{% endblock %}
{% block content %}
<h2>Category Tree</h2>
{% if can_add_category %}
<a href="{% url 'category_add' %}" class="btn btn-success mb-2">Add Category</a>
{% endif %}
<ul id="tree" class="list-unstyled">
  {% for cat in categories %}
    {% include 'includes/category_node.html' with cat=cat %}
  {% endfor %}
</ul>
<script>
function getCookie(name){const v=`; ${document.cookie}`.split(`; ${name}=`);return v.length===2?v.pop().split(';').shift():'';}
let dragged=null;
document.querySelectorAll('.cat-name').forEach(el=>{
  el.addEventListener('dragstart',e=>{dragged=el.closest('li').dataset.id;});
  el.addEventListener('dragover',e=>{e.preventDefault();});
  el.addEventListener('drop',e=>{
    e.preventDefault();
    const target=el.closest('li').dataset.id;
    if(dragged&&dragged!==target){
      fetch(`/inventory/categories/${dragged}/move/`,{method:'POST',headers:{'X-CSRFToken':getCookie('csrftoken')},body:new URLSearchParams({parent:target})}).then(()=>location.reload());
    }
  });
});
</script>
{% endblock %}
